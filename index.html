<!DOCTYPE html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="UTF-8" />

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link rel="stylesheet" href="styles.css" />

  <title>Darkest Monsters - by Pi√±a</title>
  <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="img/icons/favicon-32x32.png"
  />
  <link
    rel="apple-touch-icon"
    sizes="180x180"
    href="img/icons/apple-touch-icon.png"
  />

  <link
    rel="manifest"
    href="manifest.json"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <meta name="apple-mobile-web-app-status-bar" content="#000" />
  <meta name="theme-color" content="#000" />
  <meta
    name="description"
    content="A Darkest Dungeon boardgame companion app to draw monsters."
  />
</head>

<body>
  <div id="app">
    <main :style="{ '--unit': `${this.zoom}vh` }">
      <div class="zoom">
        <button
          @click="zoom > .39 ? zoom -= .1 : null"
          class="zoom-out"
        ></button>
        <button
          @click="zoom < 1.41 ? zoom += .1 : null"
          class="zoom-in"
        ></button>
      </div>

      <div class="enemies">
        <div
          v-for="(monster, index) in monsters"
          class="enemy"
          :class="{large: allMonsters[monster.name].large}"
        >
          <div class="card" :style="monsterCard(monster.name)">
            <div class="conditions">
              <div
                v-for="(item, i) in monster.conditions"
                class="stack"
                @click="removeCondition(i)"
                :style="{ height: `${5 + item.turns}vh`}"
              >
                <div
                  v-for="_ in item.turns"
                  class="condition"
                  :style="conditionCard(item.condition)"
                ></div>
              </div>
            </div>
          </div>

          <div class="info">
            <div class="actions">
              <button class="text-button" @click="kill(index)">
                Remove Monster
              </button>
              <button
                class="text-button"
                @click="editingConditions = index + 1"
              >
                Edit Conditions
              </button>
              <button class="text-button" @click="addingConditions = index + 1">
                Add Conditions
              </button>
              <button class="text-button" @click="startTurn(index)">
                Start Turn
              </button>
            </div>
            <div class="life">
              <button @click="wound(index, -5)" class="wound-5">-5</button>
              <div class="wounds dual-buttons">
                <button @click="wound(index, -1)"></button>
                <span>{{ monster.wounds }}</span>
                <button @click="wound(index, 1)"></button>
              </div>
              <button @click="wound(index, 5)" class="wound-5">+5</button>
            </div>
          </div>
        </div>

        <div v-for="_ in fillers" class="enemy"></div>
      </div>

      <div class="deck">
        <button class="text-button" @click="settingDeck = true">Setup Deck</button>
        <button class="text-button" @click="editingDeck = true">Edit Deck</button>
        <button class="text-button" @click="spawn()">+ Random Monster</button>
        <button class="text-button" @click="spawning = true">
          + Specific Monster
        </button>
      </div>
    </main>

    <section
      class="overlay"
      v-if="opened"
      @click.self="closeModal()"
      :style="{ '--unit': `${this.zoom}vh` }"
    >
      <div class="modal">
        <button class="close-modal" @click="closeModal()">X</button>

        <template v-if="addingConditions">
          <div class="text">Select Condition</div>
          <div class="modal-buttons">
            <template v-for="item in conditions">
              <input
                type="radio"
                :id="item"
                :value="item"
                v-model="condition"
              />
              <label
                :for="item"
                class="radio-label condition"
                :style="conditionCard(item)"
              >
              </label>
            </template>
          </div>

          <div class="text">Select Turns</div>
          <div class="modal-buttons">
            <template v-for="item in 6">
              <input type="radio" :id="item" :value="item" v-model="turns" />
              <label :for="item" class="radio-label condition">
                {{item}}
              </label>
            </template>
          </div>

          <button class="text-button" @click="addCondition()">Add</button>
        </template>

        <template v-else-if="editingConditions">
          <div class="text">Click a stack to remove it</div>

          <div class="modal-buttons">
            <button
              v-for="(item, i) in monsters[editingConditions - 1].conditions"
              class="stack"
              @click="removeCondition(i)"
              :style="{ height: `${5 + item.turns}vh`}"
            >
              <div
                v-for="_ in item.turns"
                class="condition"
                :style="conditionCard(item.condition)"
              ></div>
            </button>
          </div>

          <div class="text modal-buttons">
            <hr />
            <span>OR</span>
            <hr />
          </div>
          <button class="text-button" @click="clearConditions()">
            Clear all conditions
          </button>
        </template>

        <template v-else-if="spawning">
          <div class="text">Spawn a monster</div>
          <div>
            <select v-model="monster">
              <option value="" disabled hidden>Select Monster</option>
              <option v-for="item in monstersPool" :value="item">
                {{item}}
              </option>
            </select>
          </div>
          <button class="text-button" @click="spawn()">Spawn</button>
        </template>

        <template v-else-if="settingDeck">
          <div class="text">Set up a new deck</div>
          <div>
            <span class="text">Area: </span>
            <select v-model="zone">
              <option value="" disabled hidden>Select Area</option>
              <option v-for="item in zonePool" :value="item">
                {{item}}
              </option>
            </select>
          </div>
          <div>
            <span class="text">Act: </span>
            <select v-model="act">
              <option value="0" disabled hidden>Select Act</option>
              <option v-for="item in 3" :value="item">
                {{item}}
              </option>
            </select>
          </div>
          <button class="text-button" @click="setUp()">Confirm</button>
        </template>

        <template v-else-if="editingDeck">
          <div class="text">Edit your deck</div>

          <button class="text-button" @click="closeModal()">Close</button>
        </template>
      </div>
    </section>
  </div>

  <script src="constants/common.js"></script>
  <script src="constants/ruins.js"></script>
  <script src="constants/crimson.js"></script>
  <script src="constants/cove.js"></script>
  <script src="constants/warrens.js"></script>
  <script src="constants/darkest.js"></script>
  <script src="constants/constants.js"></script>
  <script src="app.js"></script>
</body>
